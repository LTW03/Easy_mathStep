<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Create True/False | E.M.S</title>
    <link rel="stylesheet" href="./Css_folder/Create_TFPage.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css" />
</head>
<body>
    <div class="header">
        <div class="back_btn">
            <a href="#">
                <button class="backBtn_icon">
                    <i class="fas fa-chevron-left"></i>
                </button>
                back
            </a>
        </div>
        <a href="">
            <button class="Publish_Btn" onclick="saveQuiz(event)">
                Publish
                <svg class="svg" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512">
                    <path d="M568.5 177.4L424.5 313.4C409.3 327.8 384 317.1 384 296v-72c-144.6 1-205.6 35.1-164.8 171.4 4.5 15-12.8 26.6-25 17.3C155.3 383.1 120 326.5 120 269.3c0-143.9 117.6-172.5 264-173.3V24c0-21.2 25.3-31.8 40.5-17.4l144 136c10 9.5 10 25.4 0 34.9zM384 379.1V448H64V128h50.9a12 12 0 0 0 8.6-3.7c15-15.6 32.2-27.9 51-37.7C185.7 80.8 181.6 64 169 64H48C21.5 64 0 85.5 0 112v352c0 26.5 21.5 48 48 48h352c26.5 0 48-21.5 48-48v-88.8c0-8.3-8.2-14.1-16-11.3a71.8 71.8 0 0 1-34.2 3.4c-7.3-1-13.8 4.5-13.8 11.9z"/>
                </svg>
            </button>
        </a>
    </div>

    <div class="centralize_form">
        <div class="form_container">
            <h1>Create a Quiz</h1>
            <form id="quizForm" action="Create_mcqSavingProcess.php" method="POST" enctype="multipart/form-data">
                <label for="quizName">Quiz/Lesson Name:</label>
                <input type="text" id="quizName" name="quizName" required><br><br>

                <div id="questionsContainer">
                    <!-- dynamically question input -->
                </div>
                
                <div class="exercise_buttons">
                    <button type="button" onclick="addQuestion()">Add Question</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        let questionCount = 0;

        function addQuestion() {
            questionCount++; // Increment before using it for new question

            const questionsContainer = document.getElementById('questionsContainer');

            const newQuestionBlock = document.createElement('div');
            newQuestionBlock.className = 'question-block';
            newQuestionBlock.id = `questionBlock${questionCount}`;

            newQuestionBlock.innerHTML = `
                <h3>Question ${questionCount}</h3>
                <label for="question${questionCount}">Question:</label>
                <input type="text" id="question${questionCount}" name="question${questionCount}" required><br><br>

                <label for="questionAudio${questionCount}">Upload Question Audio:</label>
                <input type="file" id="questionAudio${questionCount}" name="questionAudio${questionCount}" accept="audio/*"><br><br>

                <div class="options-container">
                    <div class="option">
                        <input type="radio" id="true${questionCount}" name="correctAnswer${questionCount}" value="true" required>
                        <label for="true${questionCount}">True</label>
                    </div>
                    <div class="option">
                        <input type="radio" id="false${questionCount}" name="correctAnswer${questionCount}" value="false" required>
                        <label for="false${questionCount}">False</label>
                    </div>
                </div><br><br>

                <button type="button" class="delete-question" onclick="deleteQuestion('questionBlock${questionCount}')"> <i class="fas fa-trash-alt"></i></button>
            `;

            questionsContainer.appendChild(newQuestionBlock);
        }

        function deleteQuestion(questionBlockId) {
            const questionBlock = document.getElementById(questionBlockId);
            questionBlock.remove();
            // Renumber questions after deletion
            renumberQuestions();
        }

        function renumberQuestions() {
            const questionBlocks = document.querySelectorAll('.question-block');
            questionCount = questionBlocks.length; // Update questionCount to match the number of questions

            questionBlocks.forEach((block, index) => {
                const currentNumber = index + 1;
                block.querySelector('h3').textContent = `Question ${currentNumber}`;
                block.id = `questionBlock${currentNumber}`;
                
                const questionInput = block.querySelector('input[type="text"]');
                questionInput.id = `question${currentNumber}`;
                questionInput.name = `question${currentNumber}`;
                block.querySelector('label[for^="question"]').setAttribute('for', `question${currentNumber}`);

                const questionAudioInput = block.querySelector('input[type="file"]');
                questionAudioInput.id = `questionAudio${currentNumber}`;
                questionAudioInput.name = `questionAudio${currentNumber}`;
                block.querySelector('label[for^="questionAudio"]').setAttribute('for', `questionAudio${currentNumber}`);
                
                block.querySelectorAll('.option').forEach(option => {
                    const input = option.querySelector('input[type="radio"]');
                    const label = option.querySelector('label');
                    input.name = `correctAnswer${currentNumber}`;
                    if (input.id.includes('true')) {
                        input.id = `true${currentNumber}`;
                        label.setAttribute('for', `true${currentNumber}`);
                    } else {
                        input.id = `false${currentNumber}`;
                        label.setAttribute('for', `false${currentNumber}`);
                    }
                });

                block.querySelector('.delete-question').setAttribute('onclick', `deleteQuestion('questionBlock${currentNumber}')`);
            });
        }

        function saveQuiz(event) {
            event.preventDefault();
            const quizForm = document.getElementById('quizForm');
            const formData = new FormData(quizForm);
            
            for (let [key, value] of formData.entries()) {
                if (!value) {
                    alert("All fields must be filled.");
                    return;
                }
            }

            const radios = document.querySelectorAll('input[type="radio"]');
            let radioCheck = Array.from(radios).some(radio => radio.checked);

            if (!radioCheck) {
                alert("Please select at least one correct answer for each question.");
                return;
            }
            
            quizForm.submit();
        }
    </script>
</body>
</html>
